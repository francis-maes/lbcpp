<?xml version="1.0" encoding="UTF-8"?>

<library name="CoreType" directory="Core/Type">
  <include file="lbcpp/Core/Pair.h"/>
  <include file="lbcpp/Core/Vector.h"/>
  
  <type name="Variable" base="" implementation="TopLevelType"/>

  <!-- Builtin Types -->
  <type name="Nil" base="Variable" implementation="NilType"/>
  <type name="Boolean" base="Variable" implementation="BooleanType"/>
  <type name="Integer" base="Variable" implementation="IntegerType"/>
    <type name="PositiveInteger" base="Integer" implementation="PositiveIntegerType"/>
      <type name="VariableIndex" base="PositiveInteger"/>

  <type name="EnumValue" base="Integer" implementation="IntegerType"/>

  <type name="Double" base="Variable" implementation="DoubleType"/>
    <type name="PositiveDouble" base="Double"/>
      <type name="NegativeLogProbability" base="PositiveDouble"/>
    <type name="Probability" base="Double" implementation="ProbabilityType"/>
    <type name="Time" base="Double" implementation="TimeType"/>

  <type name="String" base="Variable" implementation="StringType"/>
    <type name="File" base="String" implementation="FileType"/>
      <type name="LocalFile" base="File" implementation="LocalFileType"/>

  <!-- Object -->
  <class name="Object" base="Variable" abstract="yes">
    <!-- <variable type="Class" name="thisClass"/> : bad idea: induces moult complexity on DenseDoubleObjects -->
  </class>
  
  <class name="NameableObject" base="Object" abstract="yes">
    <variable type="String" name="name"/>
  </class>

  <!-- Signature -->
  <class name="Signature" base="NameableObject">
    <variable type="String" name="shortName"/>
    <variable type="String" name="description"/>
  </class>
  <class name="FunctionSignature" base="Signature"/>
  <class name="LuaFunctionSignature" base="FunctionSignature">
    <!-- variable: lua function -->
  </class>
  <class name="VariableSignature" base="Signature">
    <variable type="Type" name="type"/>
  </class>
  
  <!-- Type -->
  <class name="Type" base="NameableObject" abstract="yes">
    <variable type="Type" name="baseType"/>
    <variable type="TemplateType" name="templateType"/>
    <variable type="ObjectVector[Type]" name="templateArguments"/>
    <variable type="String" name="shortName"/>
    <code>
      virtual Variable createFromString(ExecutionContext&amp; context, const String&amp; value) const
        {return Variable(typeManager().getType(context, value));}

      virtual Variable createFromXml(XmlImporter&amp; importer) const
      {
        String text = importer.getAllSubText().trim();
        if (text.isNotEmpty())
          return createFromString(importer.getContext(), importer.getAllSubText());
        else
          return Type::loadUnnamedTypeFromXml(importer);
      }
    </code>
  </class>

  <class name="EnumerationElement" base="Object">
    <variable type="String" name="name"/>
    <variable type="String" name="oneLetterCode"/>
    <variable type="String" name="shortName"/>
    <variable type="String" name="description"/>
  </class>

  <class name="Enumeration" base="Type" abstract="yes">
    <code>
      virtual Variable createFromString(ExecutionContext&amp; context, const String&amp; value) const
        {return Type::createFromString(context, value);}

      virtual Variable createFromXml(XmlImporter&amp; importer) const
        {return Type::createFromXml(importer);}
    </code>
  </class>
  
  <class name="DefaultEnumeration" base="Enumeration">
    <variable type="GenericVector[EnumerationElement]" name="elements"/>
  </class>
  
  <class name="ConcatenateEnumeration" base="Enumeration">
    <variable type="ObjectVector[Pair[String,Enumeration]]" name="subEnumerations"/>
  </class>

  <class name="Class" base="Type" abstract="yes">
    <code>
    virtual Variable createFromString(ExecutionContext&amp; context, const String&amp; value) const
      {return Type::createFromString(context, value);}

    virtual Variable createFromXml(XmlImporter&amp; importer) const
      {return Type::createFromXml(importer);}
    </code>
  </class>
  
  <class name="DefaultClass" base="Class">
    <variable type="ObjectVector[VariableSignature]" name="variables"/>
    <variable type="Boolean" name="abstractClass"/>
  </class>

  <!-- Template Type -->
  <class name="TemplateType" base="NameableObject" abstract="yes"/>

</library>
