<?xml version="1.0" encoding="UTF-8"?>

<library name="Execution" directory="Execution">

  <include file="lbcpp/Core/Pair.h"/>
  <include file="lbcpp/Core/Vector.h"/>
  <include file="lbcpp/Execution/ExecutionContext.h"/>
  <include file="lbcpp/Execution/WorkUnit.h"/>
  <include file="lbcpp/Execution/ExecutionStack.h"/>
  <include file="lbcpp/Execution/ExecutionTrace.h"/>

  <import name="ExecutionCallback"/>
  <import name="ExecutionContext"/>

  <!-- Work Unit -->
  <class name="WorkUnit" base="Object" abstract="yes"/>
  <class name="DecoratorWorkUnit" base="WorkUnit">
    <variable type="WorkUnit" name="decorated"/>
  </class>

  <class name="CompositeWorkUnit" base="WorkUnit">
    <variable type="ObjectVector[WorkUnit]" name="workUnits"/>
    <variable type="String" name="progressionUnit"/>
    <variable type="Boolean" name="pushChildrenIntoStack"/>
    <variable type="String" name="description"/>
  </class>
  
  <!-- Test Unit -->
  <class name="TestUnit" base="WorkUnit" abstract="yes"/>

  <!-- Function Stack -->
  <class name="ExecutionStack">
    <variable type="ExecutionStack" name="parentStack"/>
    <variable type="ObjectVector[Pair[String,WorkUnit]]" name="stack"/>
  </class>

  <class name="Notification" abstract="yes"/>

  <!-- Execution Callback and Context -->
  <enumeration name="ExecutionMessageType">
    <value name="informationMessageType"/>
    <value name="warningMessageType"/>
    <value name="errorMessageType"/>
  </enumeration>

  <!-- ProgressionState -->
  <class name="ProgressionState">
    <variable type="Double" name="value"/>
    <variable type="Double" name="total"/>
    <variable type="String" name="unit"/>
  </class>
  
  <class name="ExecutionCallback" base="Object" abstract="yes"/>
  <class name="CompositeExecutionCallback" base="ExecutionCallback" abstract="yes">
    <variable type="ObjectVector[ExecutionCallback]" name="callbacks"/>
  </class>
  <class name="DispatchByThreadExecutionCallback" base="CompositeExecutionCallback" abstract="yes"/>
  
  <class name="ExecutionContext" base="CompositeExecutionCallback" abstract="yes"/>


  <!--
    -- ExecutionTrace
    -->
  <class name="ExecutionTraceItem" base="Object" abstract="yes">
    <variable type="Double" name="time"/>
  </class>

  <class name="MessageExecutionTraceItem" base="ExecutionTraceItem">
    <variable type="ExecutionMessageType" name="messageType" enumeration="yes"/>
    <variable type="String" name="what"/>
    <variable type="String" name="where"/>
  </class>

  <class name="ExecutionTraceNode" base="ExecutionTraceItem">
    <variable type="String" name="description"/>
    <variable type="ObjectVector[ExecutionTraceItem]" name="subItems"/>
    <variable type="ObjectVector[Pair[String,Variable]]" name="results"/>
    <variable type="ProgressionState" name="progression"/>
    <variable type="Double" name="timeLength"/>
  </class>

  <class name="ExecutionTrace" base="Object">
    <variable type="String" name="operatingSystem"/>
    <variable type="Boolean" name="is64BitOs"/>
    <variable type="PositiveInteger" name="numCpus"/>
    <variable type="Integer" name="cpuSpeedInMegaherz"/>
    <variable type="Integer" name="memoryInMegabytes"/>
    <variable type="String" name="context"/>

    <variable type="ExecutionTraceNode" name="root"/>
  </class>

</library>
