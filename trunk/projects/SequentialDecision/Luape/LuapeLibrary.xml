<?xml version="1.0" encoding="UTF-8"?>

<library name="Luape" directory="Luape">

  <class name="LuapeNodeCache"/>

  <!-- Luape Function -->
  <class name="LuapeFunction" abstract="yes"/>
  <class name="HomogeneousBinaryLuapeFunction" base="LuapeFunction" abstract="yes"/>
  <class name="BinaryBooleanLuapeFunction" base="HomogeneousBinaryLuapeFunction" abstract="yes"/>
    <class name="AndBooleanLuapeFunction" base="BinaryBooleanLuapeFunction">
      <constructor returnType="LuapeFunction"/>
    </class>
    <class name="EqualBooleanLuapeFunction" base="BinaryBooleanLuapeFunction">
      <constructor returnType="LuapeFunction"/>
    </class>
  <class name="BinaryDoubleLuapeFunction" base="HomogeneousBinaryLuapeFunction" abstract="yes"/>
    <class name="AddDoubleLuapeFunction" base="BinaryDoubleLuapeFunction">
      <constructor returnType="LuapeFunction"/>
    </class>
    <class name="SubDoubleLuapeFunction" base="BinaryDoubleLuapeFunction">
      <constructor returnType="LuapeFunction"/>
    </class>
    <class name="MulDoubleLuapeFunction" base="BinaryDoubleLuapeFunction">
      <constructor returnType="LuapeFunction"/>
    </class>
    <class name="DivDoubleLuapeFunction" base="BinaryDoubleLuapeFunction">
      <constructor returnType="LuapeFunction"/>
    </class>
    <class name="GreaterThanDoubleLuapeFunction" base="LuapeFunction">
      <constructor returnType="LuapeFunction"/>
    </class>
  <class name="EqualsConstantEnumLuapeFunction" base="LuapeFunction">
    <constructor arguments="const Variable&amp; value"/>
    <variable type="Variable" name="value"/>
  </class>
  <class name="GetVariableLuapeFunction" base="LuapeFunction">
    <constructor arguments="size_t variableIndex"/>
    <variable type="PositiveInteger" name="variableIndex"/>
  </class>
  <class name="StumpLuapeFunction" base="LuapeFunction">
    <constructor arguments="double threshold"/>
    <variable type="Double" name="threshold"/>
  </class>
  
  <!-- Nodes -->
  <class name="LuapeNode" base="NameableObject" abstract="yes">
    <variable type="Type" name="type"/>
    <variable type="LuapeNodeCache" name="cache"/>
  </class>
  <class name="LuapeInputNode" base="LuapeNode"/>
  <class name="LuapeFunctionNode" base="LuapeNode">
    <variable type="LuapeFunction" name="function"/>
    <variable type="GenericVector[PositiveInteger]" name="arguments"/>
  </class>
  <class name="LuapeYieldNode" base="LuapeNode">
    <variable type="PositiveInteger" name="argument"/>
  </class>

  <!-- Graph -->
  <class name="LuapeGraphUniverse" base="Object"/>
  <class name="LuapeGraph" base="Object">
    <variable type="ObjectVector[LuapeNode]" name="nodes"/>
    <variable type="LuapeGraphUniverse" name="universe"/>
  </class>

  <!-- Inference -->
  <class name="LuapeInference" base="Function" abstract="yes">
    <variable type="LuapeGraph" name="graph"/>
    <variable type="Vector[Variable]" name="votes"/>
  </class>
  <class name="LuapeBinaryClassifier" base="LuapeInference">
    <constructor/>
  </class>
  <class name="LuapeClassifier" base="LuapeInference">
    <constructor/>
  </class>
  <class name="LuapeRanker" base="LuapeInference">
    <constructor/>
  </class>
  <class name="LuapeRegressor" base="LuapeInference">
    <constructor/>
  </class>

  <!-- Problem --> 
  <class name="LuapeProblem">
    <variable type="ObjectVector[VariableSignature]" name="inputs"/>
    <variable type="ObjectVector[Function]" name="functions"/>
    <variable type="Boolean" name="failed"/>
    <function lang="lua" name="input"/>
    <function lang="lua" name="function"/>
  </class>

  <!-- Builder Type Search Space -->
  <class name="LuapeGraphBuilderTypeState">
    <variable type="PositiveInteger" name="depth"/>
    <variable type="ObjectVector[Type]" name="stack"/>
  </class>
  <class name="LuapeGraphBuilderTypeSearchSpace"/>

  <!-- Builder Decision Problem -->
  <class name="LuapeGraphBuilderAction"/>
  
  <class name="LuapeGraphBuilderState" base="DecisionProblemState">
    <variable type="LuapeGraph" name="graph"/>
    <variable type="LuapeGraphBuilderTypeSearchSpace" name="typeSearchSpace"/>
    <variable type="LuapeGraphBuilderTypeState" name="typeState"/>
    <variable type="ObjectVector[LuapeNode]" name="stack"/>
    <variable type="PositiveInteger" name="numSteps"/>
  </class>

  <class name="LuapeRPNGraphBuilderState" base="DecisionProblemState">
    <variable type="LuapeProblem" name="problem"/>
    <variable type="LuapeGraph" name="graph"/>
    <variable type="PositiveInteger" name="maxSteps"/>
    <variable type="PositiveInteger" name="numSteps"/>
  </class>

  <!-- Strong Learners -->
  <class name="LuapeLearner" abstract="yes"/>
  <class name="BoostingLearner" base="LuapeLearner" abstract="yes">
    <variable type="BoostingWeakLearner" name="weakLearner"/>
  </class>

  <class name="WeightBoostingLearner" base="BoostingLearner" abstract="yes"/>
  <class name="GradientBoostingLearner" base="BoostingLearner" abstract="yes"/>
  
  <class name="L2BoostingLearner" base="GradientBoostingLearner">
    <constructor arguments="BoostingWeakLearnerPtr weakLearner, double learningRate"/>
  </class>
  
  <class name="RankingGradientBoostingLearner" base="GradientBoostingLearner">
    <constructor arguments="BoostingWeakLearnerPtr weakLearner, double learningRate, RankingLossFunctionPtr rankingLoss"/>
    <variable type="RankingLossFunction" name="rankingLoss"/>
  </class>
  
  <!-- Weak Learners -->
  <class name="BoostingWeakLearner" base="Object" abstract="yes"/>
  <class name="SingleStumpWeakLearner" base="BoostingWeakLearner">
    <constructor/>
  </class>
  <class name="PolicyBasedWeakLearner" base="BoostingWeakLearner">
    <constructor arguments="const PolicyPtr&amp; policy, size_t budget, size_t maxDepth"/>
    <variable type="Policy" name="policy"/>
    <variable type="PositiveInteger" name="budget"/>
    <variable type="PositiveInteger" name="maxDepth"/>
  </class>
  <class name="BanditPoolWeakLearner" base="BoostingWeakLearner">
    <constructor arguments="size_t maxBandits, size_t maxDepth"/>
    <variable type="PositiveInteger" name="maxBandits"/>
    <variable type="PositiveInteger" name="maxDepth"/>
  </class>

  <!-- Wrapper to classical LBC++ learner -->
  <class name="LuapeBatchLearner" base="BatchLearner">
    <variable type="LuapeLearner" name="graphLearner"/>
    <variable type="LuapeProblem" name="problem"/>
    <variable type="PositiveInteger" name="maxIterations"/>
  </class>
  
  <!-- Sand Box -->
  <class name="LuapeSandBox" base="WorkUnit">
    <variable type="File" name="trainFile"/>
    <variable type="File" name="testFile"/>
    <variable type="PositiveInteger" name="maxExamples"/>
    <variable type="PositiveInteger" name="maxSteps"/>
    <variable type="PositiveInteger" name="budgetPerIteration"/>
    <variable type="PositiveInteger" name="maxIterations"/>
  </class>
</library>
