/*-----------------------------------------.---------------------------------.
| Filename: Identity.cr++                  | Identity CR-algorithm           |
| Author  : Francis Maes                   |    can be used as a basis       |
| Started : 19/02/2009 20:11               |    for decorator CR-algorithms  |
`------------------------------------------/                                 |
                               |                                             |
                               `--------------------------------------------*/

namespace lbcpp
{

crAlgorithm void identity(CRAlgorithmPtr crAlgorithm)
{
  CRAlgorithmPtr currentState = crAlgorithm->cloneAndCast<CRAlgorithm>();
  const void* lastChoice = NULL;
  while (true)
  {
    double r = 0;
    ChoosePtr nextChoose = currentState->runUntilNextChoose(lastChoice, &r);
    reward (r);
    
    if (!nextChoose)
      return;
      
    chooseFunction std::string stateDescription()
      {return nextChoose->stateToString(currentState);}

    chooseFunction std::string actionDescription(const void* choice)
      {return nextChoose->choiceToString(currentState, choice);}
      
    chooseFunction featureGenerator stateFeatures()
    {
      FeatureGeneratorPtr c = nextChoose->getCompositeStateFeatures();
      featureCall c;
    }
    
    chooseFunction featureGenerator actionFeatures(const void* choice)
    {
      FeatureGeneratorPtr c = nextChoose->getCompositeActionFeatures(choice);
      featureCall c;
    }
    
    chooseFunction double stateValue()
      {return nextChoose->stateValue(currentState);}

    chooseFunction double actionValue(const void* choice)
      {return nextChoose->computeActionValue(currentState, choice);}
    
    lastChoice = choose<const void* >(ChooseChoices(nextChoose), stateDescription, actionDescription, stateFeatures, actionFeatures);
  }
}

}; /* namespace lbcpp */
